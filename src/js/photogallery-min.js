/*!
 * Tiled Photogallery v1.1
 * Tiled photo gallery with photo preview, animations and youtube embedding
 * http://www.sertanyaman.com
 * MIT License
 * by Tayfun Sertan Yaman
 * https://github.com/sertanyaman/Tiled-photogallery
 */
var $container,galleryWidth,scrollbarwidth,acceptableHeight=150,maxHeight=300,rowcount=0,rowheight=[],photomargin=5,nextpagetriggered=!1,minWidth=320,prevWidth=0,idCounter=0,vieweropen=!1,curphotoid=0;function triggerGallery(){$container&&$container.waitForImages(function(){$("#albumloader").hide(),loading=!0,nextpagetriggered=!1,renderGallery()})}function renderGallery(){rowcount=1,rowheight=[],placeinGallery($container.find(".photo-box"),!0)}function getScrollBarWidth(){var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(t),document.body.appendChild(e);var i=t.offsetWidth;e.style.overflow="scroll";var o=t.offsetWidth;return i===o&&(o=e.clientWidth),document.body.removeChild(e),i-o}function placeinGallery(t,e){var i=$.Deferred();galleryWidth=Math.max($container.innerWidth(),minWidth),scrollbarwidth=getScrollBarWidth(),prevWidth=galleryWidth,!vieweropen&&$container.height()<=$(window).height()&&galleryWidth===$("body").width()&&(galleryWidth-=scrollbarwidth);var o=0;void 0!==rowheight[rowcount]&&0!==rowheight[rowcount]?o=rowheight[rowcount]:(o=acceptableHeight,rowheight[rowcount]=o);var r=[],n=[];e||$container.find(".photo-box[img-row='"+rowcount+"']").each(function(){var t=$(this),e=parseInt(t.attr("img-width")),i=parseInt(t.attr("img-height")),a=t.attr("img-id");i!==o&&(e=Math.floor(e*(o/i))),r.push(e),n.push(a)});t.each(function(){var t=$(this),e=parseInt(t.attr("img-width")),i=parseInt(t.attr("img-height")),a=t.attr("img-id");i!==o&&(e=Math.floor(e*(o/i))),r.push(e),n.push(a)});for(var a=0;a<n.length;){for(var l=0,c=0,s=a,h=1,d=1;c<galleryWidth&&((c+=r[a])<galleryWidth?(l=c,a++):a===s&&(l=galleryWidth,d=galleryWidth/c,a++),a!==n.length););a===n.length&&l<galleryWidth||(h=galleryWidth/l),1===d&&(d=h),o=Math.min(Math.floor(o*d),maxHeight),l=0;var u=0;for(u=s;u<a;u++){var p=n[u],g=Math.min(r[u],galleryWidth),f=$container.find("div[img-id='"+p+"']");g=Math.floor(g*h),f.css("width",g+"px"),f.css("height",o+"px"),f.css("display","block"),f.attr("img-row",rowcount),f.css("transition-delay"),f.css("transition-delay",u/4+"s"),f.css("opacity",1),l+=g}rowheight[rowcount]=o,a<n.length&&rowcount++,o=acceptableHeight}setTimeout(function(){loading=!1,nextpagetriggered=!1,i.resolve(),$(document).trigger("galleryloaded")},1e3*(a/4+.5))}function loadMore(t,e,i,o){var r={page:e,maxphotos:i};$.ajax({type:"POST",url:t,datatype:"html",data:r,cache:!0,async:!0,success:function(t){o(t)},fail:function(){o("")}})}WebFont.load({active:triggerGallery,inactive:triggerGallery}),$(window).load(function(){$("body").scrollTop(0),triggerGallery()}),$(document).ready(function(){$container=$("#photo-list");var t,e,i={triggerOnTouchEnd:!0,swipeStatus:function(t,e,i,o){if(vieweropen){var n=$("#photocontainer");if("move"!==e||"left"!==i&&"right"!==i)"cancel"===e?r():"end"===e&&(r(),"right"===i?$("#view-container-leftnav").click():"left"===i&&$("#view-container-rightnav").click());else{"left"===i?n.css({"-webkit-transform":"translateX(-"+o+"px)","-moz-transform":"translateX(-"+o+"px)","-ms-transform":"translateX(-"+o+"px)","-o-transform":"translateX(-"+o+"px)",transform:"translateX(-"+o+"px)"}):"right"===i&&n.css({"-webkit-transform":"translateX("+o+"px)","-moz-transform":"translateX("+o+"px)","-ms-transform":"translateX("+o+"px)","-o-transform":"translateX("+o+"px)",transform:"translateX("+o+"px)"})}}},allowPageScroll:"vertical",threshold:75,fingers:1,excludedElements:"select, textarea, .noSwipe"};function o(t,e){loading=!0,page++,loadMore(feedurl,page,maxphotos,function(t){$("#albumloader").hide();var i=$(t);""!==t.trim()&&($("#photo-list").append(i),void 0!==e&&e(),$("#photo-list").waitForImages({finished:function(){placeinGallery(i.find(".photo-box"),!1)},waitForAll:!0}))})}function r(){$("#photocontainer").css({"-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none","-o-transform":"none",transform:"none"})}function n(t){r();var e=$("#photo-info"),i=$("#protect"),o=$("#videoplay"),n=$("#video-view"),a=$("#photocontainer"),l=a.outerHeight();a.css("padding-top",0);var c=t.outerHeight()+e.outerHeight(),s=0;c<l&&(s=Math.round(l/2)-Math.round(c/2)),t.css("max-height",l-e.outerHeight()),a.css("padding-top",s),e.css("max-width",t.outerWidth()),i.css("margin-top",s),i.css("max-height",t.outerHeight()),o.css("margin-top",s),o.css("max-height",t.outerHeight()),n.css("margin-top",s),n.css("max-height",t.outerHeight()),n.css("max-width",t.outerWidth()),n.css("margin-right",t.css("margin-right")),n.css("margin-left",t.css("margin-left"))}function a(t){$.ajax({type:"GET",url:"PhotoLoader.cshtml?photoid="+t,datatype:"json",cache:!0}).done(function(e){curphotoid=t,$("#viewer").attr("src",e.path).one("load",function(){var t=$(this);if($("#photoloader").hide(),$("#view-container").show(),t.show(),$("#name").text(e.name),$("#camera").text(e.camera),$("#lens").text(e.lens),$("#aperture").text(e.aperture),$("#shutter").text(e.shutter),$("#iso").text(e.iso),$("#date").text(e.datetaken),$("#hits").text(e.hits),$("#desc").text(e.description),$("#place").text(e.place),"1"===e.hasstock?$("#hasstock").show():$("#hasstock").hide(),0===albumid){var i=$("#albumlink");i.attr("href","PhotoGallery.cshtml?album="+e.albumid),i.text(e.albumname),$("#albuminfo").show()}else $("#albuminfo").hide();""!==e.videoid?($("#videoplay").show(),$("#videolink").attr("video-id",e.videoid)):$("#videoplay").hide(),n(t),$("#view-container-overlay").fadeOut(200)})}).fail(function(){s()})}function l(){$("#photoloader").show()}function c(){var t=$("#video-view");t.attr("src",""),t.hide()}function s(){$("videoplay").hide(),c(),$("#overlay").fadeOut(400),$("#view-container").hide(),$("body").css("overflow","auto"),vieweropen=!1,renderGallery()}$("#albumloader").show(),jQuery,t="smartresize",jQuery.fn[t]=function(e){return e?this.bind("resize",(i=e,function(){var t=this,e=arguments;n?clearTimeout(n):r&&i.apply(t,e),n=setTimeout(function(){r||i.apply(t,e),n=null},o||100)})):this.trigger(t);var i,o,r,n},Modernizr.csstransitions&&((e=jQuery).fn.fadeIn=function(t,i,o){return this.filter(function(t,i){return"none"===e.css(i,"display")||!e.contains(i.ownerDocument,i)}).css("opacity",0).show().end().transition({opacity:.85},t,i,o)},e.fn.fadeOut=function(t,i,o){var r=function(){e(this).hide()};return"function"==typeof t&&(o=t,t=void 0),"object"==typeof t&&"function"==typeof t.complete&&(o=t.complete,delete t.complete),"function"==typeof i&&(o=i,i=void 0),"function"==typeof o&&(r=function(){e(this).hide(),o.apply(this,arguments)}),this.transition({opacity:0},t,i,r)}),$(window).smartresize(function(){var t=++idCounter;setTimeout(function(){if(t===idCounter){var e=$container.innerWidth();if(e<minWidth)return;(e<prevWidth||e>prevWidth)&&renderGallery(),vieweropen&&n($("#viewer"))}},100)}),$(window).scroll(function(){if(page<pagetotal){var t=$(document).height()-$(window).height()-$("footer").height(),e=$(window).scrollTop();0!==e&&e>t&&($("#albumloader").show(),loading?nextpagetriggered||($(document).one("galleryloaded",o),nextpagetriggered=!0):(loading=!0,o()))}}),$(document).keyup(function(t){t||(t=window.event);var e=t.keyCode;switch(t.charCode&&0===e&&(e=t.charCode),e){case 37:$("#view-container-leftnav").click(),t.preventDefault();break;case 38:break;case 39:$("#view-container-rightnav").click(),t.preventDefault();break;case 40:break;case 27:s(),t.preventDefault()}}),$(document).swipe(i),$container.on("click",".photo-box-link",function(t){var e=$(this);t.preventDefault();var i=e.attr("img-id");$("#overlay").fadeIn(400),$("body").css("overflow","hidden"),$("#view-container").hide(),vieweropen=!0,l(),a(i)}),$("#overlay").click(function(){s()}),$("#view-container").click(function(){s()}),$("#close-button").click(function(){s()}),$("#view-container-rightnav").click(function(t){var e=$(this),i=$container.find("li[img-id="+curphotoid+"]").next("li");if(0!==i.length){var r=i.attr("img-id");0!==r&&(c(),l(),a(r))}else o(0,function(){e.click()});t.stopPropagation()}),$("#view-container-leftnav").click(function(t){$(this);var e=$container.find("li[img-id="+curphotoid+"]").prev("li");if(0!==e.length){var i=e.attr("img-id");0!==i&&(c(),l(),a(i))}t.stopPropagation()}),$.event.trigger({type:"galleryloaded"}),$("#videolink").click(function(t){var e=$(this);t.preventDefault();var i,o,r,n=e.attr("video-id");i=n,o=$("#video-view"),$("#viewer"),r=youtubeembed,o.attr("src",r.replace("{0}",i)),o.show(),t.stopPropagation()}),acceptableHeight="album"===mode||"galleries"===mode?420:270,maxHeight="album"===mode||"galleries"===mode?420:400});